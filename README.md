# Проект "Парсер формул"
=========================

Введение
---------

Этот проект представляет собой парсер и калькулятор математических формул на языке C#. Он позволяет пользователям определять и вычислять математические формулы с переменными и пользовательскими функциями.

Функции
---------

*   Парсинг и вычисление формул
*   Поддержка переменных и пользовательских функций
*   Возможность загрузки определений переменных из базы данных
*   Параллельное загрузка переменных для улучшения производительности
*   Обработка пользовательских функций

Архитектура
------------

Проект состоит из нескольких слоев:

*   **Parser.Domain**: Содержит логику домена для парсинга и вычисления формул.
*   **Parser.Application**: Содержит логику приложения для вычисления формул и загрузки переменных.
*   **Parser.Infrastructure**: Содержит логику инфраструктуры для доступа к базе данных и внедрения зависимостей.
*   **Benchmark**: Содержит тесты для измерения производительности парсера формул.

Зависимости
----------

*   **MediatR**: Для обработки запросов и уведомлений.
*   **Microsoft.Extensions.DependencyInjection**: Для внедрения зависимостей.
*   **Microsoft.EntityFrameworkCore**: Для доступа к базе данных.
*   **NCalc**: Для вычисления формул.

Использование
-------------

Для использования парсера формул, создайте экземпляр класса `FormulaService` и вызовите метод `EvaluateAsync` с строкой формулы и словарем определений переменных.

```csharp
var formulaService = new FormulaService(variableRepository, functionHandlers);
var formula = "IF(CG=0;0;MROUND(2.375*LN(CG)+9.05;1))";
var variableDefinitions = new Dictionary<string, (string FormulaOrValue, bool IsFormula)>
{
    ["CG"] = ("BA_1 + DG6 * 5", true),
    ["BA_1"] = ("66", false),
    ["DG6"] = ("1", false),
};

var result = await formulaService.EvaluateAsync(formula, variableDefinitions);
```